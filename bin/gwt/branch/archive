#!/bin/bash
if [[ $# -eq 1 ]]; then
		selected=$1
else

	activelocal=$(git worktree list | sed -e 's/^.*\[//' | sed -e 's/\]$//')
	list=$(printf "$activelocal\nmaster" | sort | uniq -u)

	echo $list | wc -l

	if [[ -z $list ]]; then
			echo 'no branches to remove'
			exit 0
	fi

	selected=$(printf "$list\n" | fzf)
fi

if [[ -z $selected ]]; then
		exit 0
fi

# echo $selected

path=$(git worktree list | grep "$selected" | sed -e 's/ .*$//')
if [[ ! -d "$path" ]]; then

	echo "$selected - location not exits!"
	exit 0

fi

currentbranch=$(git branch | grep "*" | sed -e 's/* //')
#have to swich to another branch
if [[ $selected == $currentbranch ]]; then
	echo "can't yet remove current branch"
	exit 0
fi

root=${path:0:(($(echo $path | wc --chars)-$(echo $selected | wc --chars)-1))}

echo $selected
echo $path
echo $root

git worktree remove $selected

rm -rf $path

mkdir $root/archive

