#!/bin/bash
if [[ $# -eq 1 ]]; then
		selected=$1
else

	activeremote=$(git ls-remote --heads origin | sed -e 's/^.*heads\///')
	activelocal=$(git worktree list | sed -e 's/^.*\[//' | sed -e 's/\]$//')

	#diff only add other from active remote
	list=$(comm -23 <(tr ' ' $'\n' <<< $activeremote | sort) <(tr ' ' $'\n' <<< $activelocal | sort))

	echo $list | wc -l

	if [[ -z $list ]]; then
			echo 'no active branches to add'
			exit 0
	fi

	selected=$(printf "$list\n" | fzf)
fi

if [[ -z $selected ]]; then
		exit 0
fi

firstpath=$(git worktree list | head -1  | sed -e 's/ .*$//')
firstlocal=$(git worktree list | head -1 | sed -e 's/^.*\[//' | sed -e 's/\]$//')
root=${firstpath:0:(($(echo $firstpath | wc --chars)-$(echo $firstlocal | wc --chars)-1))}

brfull=${root}/${selected}

if [[ -d "$brfull" ]]; then

	echo "$selected - location already exits!"

else

	mkdir -p "${brfull}"

	git worktree add ${brfull} origin/${selected}

	cd "${brfull}"

	git checkout ${selected}

	switch "$selected"

fi
