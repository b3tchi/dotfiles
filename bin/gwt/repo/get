#!/bin/bash
pwd
echo $rootpath

repo_name="mpo-followup-fe-acs"

if [[ ! "$(pwd)" =~ "$rootpath" ]]; then
  echo "not in repos folder"
fi

repo_owner=$(basename "$(pwd)")

# $(gh search repos ${repo_owner}/${repo_name} --json defaultBranch --jq ".[].defaultBranch")

default_branch=$(gh search repos ${repo_owner}/${repo_name} --json defaultBranch --jq ".[].defaultBranch")

if [[ -z $default_branch ]]; then
  echo "repository ${repo_owner}/${repo_name} not found cannot continue"
  exit
fi

echo "path" ${repo_owner}/${repo_name}
echo $default_branch

if [[ -d "$(pwd)/${repo_name}" ]]; then
  echo "folder already exists"
  exit
fi

#TBD
repo_user="$(pwd | cut --delimiter=/ --fields=5)"
acc="github.com-${repo_user}"

if [[ ! "$(cat ~/.ssh/config)" =~ "Host ${acc}" ]]; then
  echo "sshconfig ${acc} not found"
  exit
fi

exit

# create folder
mkdir -p "$(pwd)/${repo_name}/${default_branch}"

cd "$(pwd)/${repo_name}/${default_branch}"
git init .


git remote add origin "git@${acc}:LEGO/${reponame}.git"

git worktree add ${default_branch} origin/${default_branch}

git checkout ${selected}

# gwt switch "$selected"

# git checkout -b ${default_branch}
# local -p
